<!DOCTYPE html>
<html>
<head>
    <title>文章详情</title>
</head>
<body>
<nav>
    <a href="index.html">首页</a> |
    <a href="about.html">关于</a>
</nav>

<div id="post"></div>

<h3>评论区</h3>
<div id="comments"></div>

<!-- 评论提交表单 -->
<form id="commentForm">
    <input type="text" name="author" placeholder="你的名字" required>
    <textarea name="content" placeholder="评论内容" required></textarea>
    <button type="submit">提交</button>
</form>

<script type="module">
    import { supabase } from './supabase.js'

    // 获取URL中的文章ID（如 post.html?id=1）
    const postId = new URLSearchParams(window.location.search).get('id')

    // 加载文章详情
    async function loadPost() {
        const { data } = await supabase
            .from('posts')
            .select('*')
            .eq('id', postId)
            .single()

        document.getElementById('post').innerHTML = `
        <h1>${data.title}</h1>
        <p>${data.content}</p>
      `
    }

    // 加载评论
    async function loadComments() {
        const { data } = await supabase
            .from('comments')
            .select('*')
            .eq('post_id', postId)

        const commentsDiv = document.getElementById('comments')
        data.forEach(comment => {
            commentsDiv.innerHTML += `
          <div>
            <p><strong>${comment.author}</strong>：${comment.content}</p>
          </div>
        `
        })
    }

    // 提交评论
    document.getElementById('commentForm').addEventListener('submit', async (e) => {
        e.preventDefault()
        const author = e.target.author.value
        const content = e.target.content.value

        await supabase
            .from('comments')
            .insert([{ post_id: postId, author, content }])

        // 重新加载评论
        loadComments()
        e.target.reset()
    })

    // 初始化
    loadPost()
    loadComments()
</script>
</body>
</html>